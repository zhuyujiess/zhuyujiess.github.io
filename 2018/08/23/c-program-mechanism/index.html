<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!--Description-->

    

    
        <meta name="description" content="1972年，贝尔实验室的丹尼斯·里奇和肯·汤普逊在开发UNIX操作系统时设计了C语言。从那时开始，C语言已经从其位于贝尔室验室的发源地传播到世界各地，它已经成为全球程序员的公共语言。"/>
    

    <!--Author-->
    
        <meta name="author" content="John Doe"/>
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="C语言编程机制"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="1972年，贝尔实验室的丹尼斯·里奇和肯·汤普逊在开发UNIX操作系统时设计了C语言。从那时开始，C语言已经从其位于贝尔室验室的发源地传播到世界各地，它已经成为全球程序员的公共语言。"/>
    

    <!--Open Graph Site Name-->
        <meta property="og:site_name" content="朱玉洁的个人网站"/>

    <!--Type page-->
    
        <meta property="og:type" content="article"/>
    

    <!--Page Cover-->
    
    
        <meta property="og:image" content="http://yoursite.comhttp://oqvcferhi.bkt.clouddn.com/xiaoxiao.jpg"/>
    

        <meta name="twitter:card" content="summary_large_image"/>

    

    
        <meta name="twitter:image" content="http://yoursite.comhttp://oqvcferhi.bkt.clouddn.com/xiaoxiao.jpg"/>
    

    <!-- Title -->
    
    <title>C语言编程机制 - 朱玉洁的个人网站</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"/>
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet"/>

    <!-- Google Analytics -->
    


    <!-- favicon -->
    

</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">欢迎来访</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                主页
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archive">
                            
                                归档
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                标签
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/about">
                            
                                关于我
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('http://oqvcferhi.bkt.clouddn.com/xiaoxiao.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>C语言编程机制</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                            Posted by Zuckjet on
                        
                        
                            2018-08-23
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a class="zhuyujiess-tag" href="/tags/编程/">编程</a> <a class="zhuyujiess-tag" href="/tags/C语言/">C语言</a>



                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>1972年，贝尔实验室的丹尼斯·里奇和肯·汤普逊在开发UNIX操作系统时设计了C语言。从那时开始，C语言已经从其位于贝尔室验室的发源地传播到世界各地，它已经成为全球程序员的公共语言。<br><a id="more"></a>
尽管在过去的20多年里，许多人都从C语言转而使用其他编程语言（如C++、Java等），但因为C语言具有汇编语言才具有的微调控能力、与UNIX系统的紧密联系等优点，使得其在40多年后的今天依然经久不衰。如果要在我的工作技术栈之外掌握一门新的语言，毫无疑问C语言是我的首选。本文将简单介绍一下C语言的编程机制，为以后的深入学习打下坚实的基础。</p>
<p>用C语言编写程序时，编写的内容被存储在文本文件中，该文件被称为<em>源代码文件</em>。大部分C系统，都要求文件名以.c结尾，下面是<code>hello.c</code>文件的源代码：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;hello world!&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>C编程的基本策略是，用程序把源代码文件转换为可执行文件。典型的C实现通过<em>编译</em>和<em>链接</em>两个步骤来完成这一过程。<em>编译器把源代码转换成中间代码，链接器把中间代码和其他代码合并</em>，生成可执行文件。<br>
中间文件有多种形式。我们在这里描述的是最普遍的一种形式，即把源代码转换为机器语言代码，并把结果放在目标代码文件中。虽然目标文件中包含有机器语言代码，但是并不能直接运行该文件。因为目标文件中
存储的是编译器翻译的源代码，这还不是一个完整的程序。那么目标文件相比完整的程序缺少了什么呢？</p>
<ol>
<li>目标代码文件缺失启动代码。启动代码充当着程序和操作系统之间的接口。</li>
<li>目标代码还缺少库函数。几乎所有的C程序都要使用C标准库中的函数。</li>
</ol>
<p>链接器的作用是，把你编写的目标代码、系统的标准启动代码和库代码这三部分合并成一个文件，即可执行文件。对于库代码，链接器只会把程序中要用到的库函数代码提取出来。</p>
<p>阅读本文至此，你应该对C语言的编程机制有了一个整体的认识。现在我们通过上文提到的入门程序<code>hello.c</code>来观察一下这个过程。
首先我们使用gcc编译器编译<code>hello.c</code>源程序:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc hello.c</span><br></pre></td></tr></table></figure></p>
<p>因为没有指定文件名，默认会生成一个名为a.out的可执行文件，我们可以在命令行执行它：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./a.out</span><br><span class="line">// 输出hello world</span><br></pre></td></tr></table></figure></p>
<p>程序的输出结果我们已经看到了，但是或许你有很多的疑问。比如<code>a.out</code>这个文件的后缀名有些新颖，里面的内容又是什么呢？如果你是个急性子，说不定已经在命令行输入<code>vim a.out</code>去揭开它的庐山真面目了，然而你看到是类似这样的东西：
<img src="http://oqvcferhi.bkt.clouddn.com/aout.png" alt="a.out文件内容" title="a.out文件内容">
当你看到这样极其不利于阅读的内容后（由汇编器和链接器生成的，内容是二进制，而非可读的文本形式），可能一时之间不知道如何去理解它。不要急，让我们先来看看<code>a.out</code>这个文件是什么：<br></p>
<p><em>a.out是旧版类Unix系统中用于执行档、目的码和后来系统中的函数库的一种文件格式，这个名称的意思是汇编器输出。
尽管目前大多数类Unix系统都已改用ELF格式，不再采用a.out格式，但编译器和链接器依然会在用户未指定文件名时，将输出文件取名为“a.out”。</em></p>
<p>现在我们明白了<code>a.out</code>这个文件的来由了，但是在介绍它的时候说过<strong>大多数类Unix系统都已改用ELF格式</strong>。因此，我们要了解<code>a.out</code>文件这个问题的本质就变成了去了解ELF格式的文件了。<br>
ELF是Executable and Linkable Format的缩写形式即可执行和可链接格式，常被称为ELF格式，最初由UNIX系统实验室做为应用程序二进制接口的一部分而制定和发布。
ELF规范把ELF文件宽泛地称为<em>目标文件</em>，这与上文提到的目标文件不一样。一般地，我们把经编译但没有链接的文件（比如Unix/Linux系统上的.o文件）称为目标文件，而ELF文件
仅指链接好的可执行文件；但在ELF规范中，所有符合ELF格式规范的都称为ELF文件，也称为目标文件，这两个名字是相同的，而经过编译但没有链接的文件则称为”可重定位文件“或”待重定位文件“。
目标文件/ELF文件主要分为以下三种类型：</p>
<ul>
<li>可重定位文件，也就是本文最开始介绍的目标文件，由源文件编译而成，但还没有链接成可执行文件。</li>
<li>共享目标文件，即动态链接库文件。</li>
<li>可执行文件，经过链接的、可以执行的程序文件。</li>
</ul>
<p>从链接的角度和运行的角度，可以分别把目标文件的组成部分做以下的划分：
<img src="http://oqvcferhi.bkt.clouddn.com/elf-table.png" alt="ELF文件格式" title="ELF文件格式">
ELF文件头（ELF header）位于文件的最开始处，包含有整个文件的结构信息。节（section）是专用于连接过程而言的，在每个”节“中包含有指令数据、符号数据、重定位数据等等。程序头表（programheader table）在运行过程中是必须的，在
链接过程中是可选的，因为它的作用是告诉系统如何创建进程的镜像。节头表包含有文件中所有”节“的信息。在链接视图中，”节头表“是必须存在的。</p>
<p>由于篇幅所限，关于ELF文件相关的内容只能介绍这么多，现在让我们回归到要解的问题上去。刚才我们说过查看<code>a.out</code>文件内容就是查看ELF文件内容，而查看ELF文件内容我们可以使用<code>readelf</code>相关命令。现在我们通过以下命令查看<code>a.out</code>文件内容：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -a a.out</span><br></pre></td></tr></table></figure></p>
<p><img src="http://oqvcferhi.bkt.clouddn.com/readelf-a.png" alt="readelf查看内容" title="readelf查看内容">
除了使用readel命令查看ELF文件，我们还可以使用<code>objdump</code>命令.那么readelf命令和objdump命令的区别是什么呢，参考quora上一位网友的回复：<br>
<em>The readelf program can dump all the information in an ELF file. ELF is the object file format used on pretty much all modern operating systems, except for Windows and Mac OS.
The objdump program can dump generic information from a file in (almost) any object file format, including ELF but also including COFF/PE (used on Windows), Mach-O (used on Mac OS), S-records, IHEX, etc. It can dump some file-format-specific information, but not all.
So if you know you have an ELF file, use readelf. If you don’t know, use objdump.</em></p>
<p>一部分人看到这些命令后也许就有些不耐烦了，我只是想打开文件看看里面长啥样，你给我介绍一堆其他命令，就没有简单粗暴一点的解决方案吗？这个真的可以有，我们可以用<code>ht editor</code>直接打开这些可执行文件。在mac下我们可以通过下面命令安装<code>ht editor</code>:
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ht</span><br></pre></td></tr></table></figure></p>
<p>在命令行中输入ht进入ht editor的编辑界面,通过f3打开文件，显示结果如下：
<img src="http://oqvcferhi.bkt.clouddn.com/ht-editor.png" alt="a.out文件内容" title="a.out文件内容"></p>
<p>说了半天都是关于<code>a.out</code>文件，上文我们提到过编译器最开始是生成目标代码的，其拓展名是<code>.o</code>。然而我们在编译代码的过程中却没看到这个后缀为<code>.o</code>的文件，这是因为一旦连接器生成了完整的可执行程序，就会将其删除。如果我们可以通过以下命令生成目标代码：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c hello.c</span><br></pre></td></tr></table></figure></p>
<p>这时你在当前目录就会生成<code>hello.o</code>文件，因为目标文件也是ELF文件的一种，赶快用上面介绍的几种方法打开看看吧。</p>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <!-- <hr />

<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    

                    

                    
                        <li>
                            <a href="https://github.com/klugjo/hexo-theme-clean-blog" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">&copy; 2018 John Doe<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer> -->


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>